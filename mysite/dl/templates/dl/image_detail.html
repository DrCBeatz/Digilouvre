{% extends "dl_menu.html" %}
{% load humanize %} <!-- https://docs.djangoproject.com/en/3.0/ref/contrib/humanize -->
{% block head %}

<style>
  .overlay {
  position: absolute;
  top: 25px;
  /*top: 150px;*/
  left: 0;
  width: 100%;
  height: 100%;
  /*height: auto;*/
  /*height: 50%;*/
  /*max-height: 50%;*/

  /*overflow: scroll;*/
  /*white-space:nowrap;*/
  z-index: 10;
  display: none;
  /*image-rendering: pixelated;*/
  /*transform: scale(0.5)*/
  background-color: rgba(0,0,0,0.5); /*dim the background*/
}

.zoom-img{
    /*display: block;*/
    /*margin-left: auto;*/
    /*margin-right: auto;*/
    /*width: 50%;*/

    width:100%;
    margin-top: 50px;
    /*height: 50%;*/
    /*height:auto;*/
    /*display: flexbox;*/
    /*margin-bottom: 100%;*/
    border:1px solid black;
}
</style>

<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">

<style>
    html,
    body {
      position: relative;
      height: 100%;
    }

    .swiper-container {
      width: 100%;
      height: 66%;
    }

    .swiper-slide {
      background-position: center;
      background-size: contain;
      background-color: black;
      background-repeat: no-repeat;

    }

    .swiper-pagination-bullet {
  opacity: 0.5;
    background: var(--swiper-pagination-color, var(--swiper-theme-color));
    background-color: gray;
}
    .swiper-pagination-bullet-active {
    opacity: 1;
    background: var(--swiper-pagination-color, var(--swiper-theme-color));
    background-color: white;
}
.swiper-slide {
  display: block;
}

</style>
{% endblock %}
{% block carousel %}

<!--<div id="overlay" class="overlay" style="text-align: center;" onclick="document.getElementById('overlay').style.display = 'none';" >-->
<div id="overlay" class="overlay" style="text-align: center;">
    <!--<div class="zoom-within-container"></div>-->
<img class="zoom-img" id="zoom-img" src="/media/{{ image.image }}">
<!--<img style="width:100%; margin-top: 50px; display: flexbox; margin-bottom: 50%; border:1px solid black;" src="/media/{{ image.image }}" alt="zoom">-->
</div>


<div id="swiper-container" class="swiper-container swiper-container-fade swiper-container-initialized swiper-container-horizontal swiper-container-pointer-events">
    <div class="swiper-wrapper">

    <a class="swiper-slide" style="background-image:url({{ image.preview.url }});" href="/media/{{ image.image }}"></a>
    <!--<a class="swiper-slide" style="background-image:url('/media/{{ image.image }}');" href="/media/{{ image.image }}" target="_blank"></a>-->
    <!--<a class="swiper-slide" style="background-image:url('/media/{{ image.image }}');" href="/media/{{ image.image }}"></a>-->
    <!--<a class="swiper-slide" style="background-image:url('/media/{{ image.image }}');" onclick="document.getElementById('overlay').style.display = 'block';"></a>-->



</div>
<!--<div class="swiper-pagination swiper-pagination-white"></div>-->
{% if previous_image and next_image %}
<a href="{% url 'dl:image_detail' next_image.id %}"><div class="swiper-button-prev swiper-button-white"></div></a>
<a href="{% url 'dl:image_detail' previous_image.id %}"><div class="swiper-button-next swiper-button-white"></div></a>

{% elif next_image %}

    <a href="{% url 'dl:image_detail' next_image.id %}"><div class="swiper-button-prev swiper-button-white"></div></a>
{% elif previous_image %}

<a href="{% url 'dl:image_detail' previous_image.id %}"><div class="swiper-button-next swiper-button-white"></div></a>

{% endif %}



  </div>
{% endblock %}
{% block content %}
<p></p>
<p></p>
<p></p>
<p></p>

<span style="float: right; ">
{% if image.owner == user %}
<a href="{% url 'dl:image_update' image.id %}"><i class="fa fa-pencil"></i></a>
<a href="{% url 'dl:image_delete' image.id %}"><i class="fa fa-trash"></i></a>
{% endif %}
</span>
<!--<div class="display: grid;height: 100%;">-->
<!--<img  class="img-responsive center-block" style="max-width:66%;max-height:66vh;margin: auto;" src="/media/{{ image.image }}" onclick="document.getElementById('overlay').style.display = 'block';">-->
<!--</div>-->

<p class="text-center"><small>(click to view full size image)</small></p>

<!--{% if previous_image and next_image %}-->
<!--<a href="{% url 'dl:image_detail' next_image.id %}"><span class="glyphicon glyphicon-arrow-left" style="color: white;"></i></a>-->
<!--<a href="{% url 'dl:image_detail' previous_image.id %}"><span class="glyphicon glyphicon-arrow-right pull-right" style="color: white;"></i></a>-->
<!--{% elif next_image %}-->
<!--    <a href="{% url 'dl:image_detail' next_image.id %}"><span class="glyphicon glyphicon-arrow-left" style="color: white;"></i></a>-->
<!--{% elif previous_image %}-->
<!--<div class="text-right">-->
<!--<a href="{% url 'dl:image_detail' previous_image.id %}"><span class="glyphicon glyphicon-arrow-right" style="color: white;"></i></a>-->
<!--</div>-->
<!--{% endif %}-->


<h3>{{ image.title }}</h3>
<p>{{ image.description }}</p>

<p>{% if image.link_title is not None and image.link_title != "" and image.link_url is not None and image.link_url != "" %}
<h4><a href="{{ image.link_url }}" >{{ image.link_title }}</a></h4>
<p></p>
{% endif %}</p>

{% if product_list %}

<button type="button" id="button" class="btn btn-primary btn-block">Buy Image</button>
<p></p>
<div id="product-list" style="display:none;">
<ul class="list-group">
    <h3 class="list-group-item-heading">This image is available in the following formats:</h3>
  {% for product in product_list %}

    {% if product.product_enabled %}
        <a class="list-group-item" href="{% url 'dl:product'  product.id %}">
                {% if product.owner == user %}
        <span class="pull-right">
                <form action="{% url 'dl:product_delete' product.id %}">
                    <button type="submit" class="btn btn-link">
                        <span class="glyphicon glyphicon-trash"></span>
                    </button>
                </form>
            </span>
            <span class="pull-right">
                <form action="{% url 'dl:product_update' product.id %}">
                    <button type="submit" class="btn btn-link">
                        <span class="glyphicon glyphicon-pencil"></span>
                    </button>
                </form>
            </span>
        {% endif %}
        <h4 class="list-group-heading"> {{ product.item_name }} - ${{ product.price|floatformat:2 }}</h4>

    </a>
    {% endif %}
  {% endfor %}
</ul>
</div>
{% endif %}


<p>
</p>
<p>
<!--<a href="{% url 'dl:all' %}">All Images</a>-->
<a href="{% url 'dl:all' %}" class="btn btn-default btn-block" role="button">All Images</a>
</p>

<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<script>
    document.getElementById("swiper-container").addEventListener('touchstart', handleTouchStart, false);
document.getElementById("swiper-container").addEventListener('touchmove', handleTouchMove, false);
// document.addEventListener('touchstart', handleTouchStart, false);
// document.addEventListener('touchmove', handleTouchMove, false);

var xDown = null;
var yDown = null;

function getTouches(evt) {
  return evt.touches ||             // browser API
         evt.originalEvent.touches; // jQuery
}

function handleTouchStart(evt) {
    const firstTouch = getTouches(evt)[0];
    xDown = firstTouch.clientX;
    yDown = firstTouch.clientY;
};

function handleTouchMove(evt) {
    if ( ! xDown || ! yDown ) {
        return;
    }

    var xUp = evt.touches[0].clientX;
    var yUp = evt.touches[0].clientY;

    var xDiff = xDown - xUp;
    var yDiff = yDown - yUp;

    if ( Math.abs( xDiff ) > Math.abs( yDiff ) ) {/*most significant*/
        if ( xDiff > 0 ) {
            /* left swipe */
            {% if previous_image %}
            window.location.href = 'https://www.digilouvre.com/{% url 'dl:image_detail' previous_image.id %}';
            {% endif %}
        } else {
            /* right swipe */
            {% if next_image %}
            window.location.href = 'https://www.digilouvre.com/{% url 'dl:image_detail' next_image.id %}';
            {% endif %}
        }
    } else {
        if ( yDiff > 0 ) {
            /* up swipe */
        } else {
            /* down swipe */
        }
    }
    /* reset values */
    xDown = null;
    yDown = null;
};
</script>
  <script>
    var swiper = new Swiper('.swiper-container', {
        observer: true,
        observeParents: true,
      spaceBetween: 30,
      loop: true,
      centeredSlides: true,
      effect: 'fade',
    //   pagination: {
    //     el: '.swiper-pagination',
    //     clickable: true,
    //   },
    //   navigation: {
    //     nextEl: '.swiper-button-next',
    //     prevEl: '.swiper-button-prev',
    //   },
    //   autoplay: {
    //     delay: 2500,
    //     disableOnInteraction: false,
    //   },
    });
  </script>
<script>
    var button = document.getElementById('button'); // Assumes element with id='button'

button.onclick = function() {
    var div = document.getElementById('product-list');
    if (div.style.display !== 'none') {
        div.style.display = 'none';
        document.querySelector('#button').innerHTML = 'Buy Image';
        document.querySelector('#button').innerText = 'Buy Image';
        document.querySelector('#button').textContent = 'Buy Image';

    }
    else {
        div.style.display = 'block';
        document.querySelector('#button').innerHTML = 'Hide Products';
        document.querySelector('#button').innerText = 'Hide Products';
        document.querySelector('#button').textContent = 'Hide Products';
        div.scrollIntoView();
    }
};
</script>
{% endblock %}
